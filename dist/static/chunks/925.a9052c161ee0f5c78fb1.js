"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[925],{7114:function(t,e,n){n.d(e,{Wl:function(){return o},WA:function(){return c},p7:function(){return p},Bc:function(){return h}});var r=n(266),a=n(809),u=n.n(a),s=n(8178),i=function(t,e,n){var r=t.lat,a=t.lng,u=n.northEast,s=n.southWest,i={y:0,x:0};return i.y=(r-u.lat)/(s.lat-u.lat)*e.height,i.x=(a-s.lng)/(u.lng-s.lng)*e.width,i},o=function(t,e,n,r){return{from:i(t,n,r),to:i(e,n,r)}},c=function(t,e){l(t,e,"gray",1,.5),l(t,e,"white",3,1),l(t,e,"gray",1,1.5)},l=function(t,e,n,r,a){var u=e.width,s=e.height;t.beginPath(),t.lineWidth=r.toString(),t.strokeStyle=n,t.arc(u/2,s/2,(s/2-r)*a,0,2*Math.PI),t.stroke()},f=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},p=function(t,e,n,r){return function(t){if(null==t[0]||null==t[t.length-1])return t;for(var e=[t[0]],n=1;n<t.length-1;n++){var r=f(t[n-1],t[n]),a=f(t[n+1],t[n]);0!=r.x&&(r.x*=-1),0!=r.y&&(r.y*=-1),r.x==a.x&&r.y==a.y||e.push(t[n])}return e.push(t[t.length-1]),e}(t).map((function(t){return function(t,e,n,r){var a=t.x,u=t.y,s=r.southWest,i=r.northEast,o=u*n+n/2,c=a*n+n/2,l={lat:0,lng:0};return l.lat=o/e.height*(s.lat-i.lat)+i.lat,l.lng=c/e.width*(i.lng-s.lng)+s.lng,l}(t,e,n,r)}))},h=function(){var t=(0,r.Z)(u().mark((function t(e,n,r,a,i){var c,l,f,h,d,g,m,v,y,x,w,b,k;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=a.getBounds()._northEast,l=a.getBounds()._southWest,h=o(e,n,i,f={northEast:c,southWest:l}),d=h.from,g=h.to,t.next=6,s.Z.load();case 6:return t.next=8,s.Z.imageProcessing({map:i,from:d,to:g,tileSize:r});case 8:return m=t.sent,v=m.data.payload,y=v.result,x=v.tilePath,w=v.tiles,b=x.map((function(t){return t.index})),k=p(b,y,r,f),t.abrupt("return",{imageData:y,path:k,tiles:w,boundaries:f});case 16:case"end":return t.stop()}}),t)})));return function(e,n,r,a,u){return t.apply(this,arguments)}}()},4925:function(t,e,n){var r=n(2809),a=n(266),u=n(318),s=n(219),i=n(809),o=n.n(i),c=n(6008),l=n.n(c),f=n(7294),p=n(7114),h=n(8178),d=n(4891),g=n(6893),m=n(5893),v=["map","layers","onResult","onStatus","triggerRender","realTimeBy","boatManager"];function y(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function x(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?y(Object(n),!0).forEach((function(e){(0,r.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var w={text:"Processing Map",index:0},b={text:"Generate Autonomus Path",index:1},k={text:"Finished Render",index:2};e.Z=function(t){var e=t.map,n=t.layers,r=t.onResult,i=t.onStatus,c=t.triggerRender,y=(t.realTimeBy,t.boatManager),P=((0,s.Z)(t,v),f.useRef()),_=f.useState({height:"100%",width:"100%"}),Z=(0,u.Z)(_,2),S=Z[0],j=Z[1],O=f.useState(w),E=(0,u.Z)(O,2),D=E[0],R=E[1],W=f.useState([]),z=(0,u.Z)(W,2),I=z[0],M=z[1],N=f.useState(null),B=(0,u.Z)(N,2),C=B[0],A=B[1],L=f.useState(!1),T=(0,u.Z)(L,2),F=T[0],G=T[1],q=f.useState(!1),H=(0,u.Z)(q,2),J=H[0],K=H[1],Q=function(){var t=(0,a.Z)(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",n.map((function(t){return e.removeLayer(t)})));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),U=function(){var t=(0,a.Z)(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",n.map((function(t){return e.addLayer(t)})));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();function V(t){var e=y.curPos,n=y.destPos;return t[0]=n,t[t.length-1]=e,t}(0,f.useEffect)((function(){y.on("recalculate",(function(){G((function(t){return!t}))})),y.on("move",(function(){y.autoDrive?K((function(t){return!t})):G((function(t){return!t}))}))}),[]);var X=function(){var t=(0,a.Z)(o().mark((function t(n){var r,a,u,s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=y.curPos,a=y.destPos,u=y._tileSize,t.next=5,(0,p.Bc)(r,a,u,e,n);case 5:return(s=t.sent).path=V(s.path),t.abrupt("return",s);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Y=function(){var t=(0,a.Z)(o().mark((function t(e){var n,r,a,u,s,i,c,l,f,d,g,m;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e,r=y.curPos,a=y.destPos,u=y._tileSize,s=y._boundaries,i=(0,p.Wl)(r,a,n,s),c=i.from,l=i.to,t.next=8,h.Z.recalculatePath({tiles:I,from:c,to:l,tileSize:u,imageData:n});case 8:return f=t.sent,d=f.data.payload.aPath,g=d.map((function(t){return t.index})),m=V(m=(0,p.p7)(g,n,u,s)),t.abrupt("return",{path:m,tiles:I,boundaries:s,imageData:n});case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),$=function(t){l()(t,function(){var e=(0,a.Z)(o().mark((function e(n,a){var u,s,i,c,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=P.current.getContext("2d"),s=t.getSize(),j({height:s.y,width:s.x}),i=a.getContext("2d"),c=i.getImageData(0,0,s.x,s.y),y._processedImage=c,A(c),!r){e.next=19;break}return R(b),e.next=11,X(c);case 11:l=e.sent,M(l.tiles),u.clearRect(0,0,a.width,a.height),u.putImageData(l.imageData,0,0),r(l),R(k),e.next=22;break;case 19:u.clearRect(0,0,a.width,a.height),u.putImageData(c,0,0),R(k);case 22:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())};return f.useEffect((function(){e&&n.length>0&&(Q(),$(e),U())}),[e,n]),f.useEffect((function(){e&&(R(w),$(e))}),[c]),f.useEffect((0,a.Z)(o().mark((function t(){var n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(P.current.getContext("2d"),!e||null==y._boundaries){t.next=6;break}return t.next=4,Y(C);case 4:n=t.sent,r(n);case 6:case"end":return t.stop()}}),t)}))),[F]),f.useEffect((0,a.Z)(o().mark((function t(){var n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:P.current.getContext("2d"),e&&(n=V(y._aPath),r({path:n}));case 2:case"end":return t.stop()}}),t)}))),[J]),f.useEffect((function(){i(D)}),[D]),(0,m.jsxs)("div",{className:"w-full h-full absolute",children:[(0,m.jsxs)(d.E.div,{style:{top:-50},className:"absolute z-50 shadow-xl rounded-br left-0 bg-white flex p-2 items-center",animate:D==k?{top:-50}:{top:0},transition:{duration:.5},children:[(0,m.jsx)(g.nbt,{className:"mr-3 animate-spin"}),(0,m.jsx)("span",{className:"text-sm",children:D.text})]}),(0,m.jsx)("canvas",x({className:"pointer-events-none absolute z-0",ref:P},S))]})}},8178:function(t,e,n){var r=n(8216),a=n(5997),u=function(){function t(){(0,r.Z)(this,t)}return(0,a.Z)(t,[{key:"_dispatch",value:function(t){var e=this,n=t.msg;return this._status[n]=["loading"],this.worker.postMessage(t),new Promise((function(t,r){var a=setInterval((function(){var u=e._status[n];(null===u||void 0===u?void 0:u.length)>0?("done"===u[0]&&t(u[1]),"error"===u[0]&&r(u[1]),"loading"!==u[0]&&(delete e._status[n],clearInterval(a))):console.error("cannot find msg event name !!!")}),50)}))}},{key:"load",value:function(){var t=this;return this._status={},this.worker=new Worker("./js/cv.worker.js"),this.worker.onmessage=function(e){return t._status[e.data.msg]=["done",e]},this.worker.onerror=function(e){return t._status[e.message]=["error",e]},this._dispatch({msg:"load"})}},{key:"turnRed",value:function(t){return this._dispatch({msg:"turnRed",payload:t})}},{key:"imageProcessing",value:function(t){return this._dispatch({msg:"imageProcessing",payload:t})}},{key:"recalculatePath",value:function(t){return this._dispatch({msg:"recalculatePath",payload:t})}},{key:"singleAStar",value:function(t){return this._dispatch({msg:"singleAStar",payload:t})}},{key:"simpleReddenMap",value:function(t){return this._dispatch({msg:"simpleReddenMap",payload:t})}}]),t}();e.Z=new u}}]);