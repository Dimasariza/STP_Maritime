(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[611],{2818:function(){!function(){var t=L.Marker.prototype._initIcon,e=L.Marker.prototype._setPos,n="msTransform"===L.DomUtil.TRANSFORM;L.Marker.addInitHook((function(){var t=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor;t&&(t=t[0]+"px "+t[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||t||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",(function(t){t.target._applyRotation()}))})),L.Marker.include({_initIcon:function(){t.call(this)},_setPos:function(t){e.call(this,t),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,n?this._icon.style[L.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(t){return this.options.rotationAngle=t,this.update(),this},setRotationOrigin:function(t){return this.options.rotationOrigin=t,this.update(),this}})}()},2024:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return Q}});var a=n(2809),o=n(3789),r=n(219),i=n(557),l=n(7294);function s(){return(0,i.mE)().map}var c=n(1459),u=n(5243),p=n.n(u);const f=(0,c.dW)((function({position:t,...e},n){const a=new u.Marker(t,e);return{instance:a,context:{...n,overlayContainer:a}}}),(function(t,e,n){e.position!==n.position&&t.setLatLng(e.position),null!=e.icon&&e.icon!==n.icon&&t.setIcon(e.icon),null!=e.zIndexOffset&&e.zIndexOffset!==n.zIndexOffset&&t.setZIndexOffset(e.zIndexOffset),null!=e.opacity&&e.opacity!==n.opacity&&t.setOpacity(e.opacity),null!=t.dragging&&e.draggable!==n.draggable&&(!0===e.draggable?t.dragging.enable():t.dragging.disable())})),d=(0,c.SO)((function(t,e){return{instance:new u.Popup(t,e.overlayContainer),context:e}}),(function(t,e,n,a){const{onClose:o,onOpen:r,position:i}=n;(0,l.useEffect)((function(){const{instance:n}=t;function l(t){t.popup===n&&(n.update(),a(!0),null==r||r())}function s(t){t.popup===n&&(a(!1),null==o||o())}return e.map.on({popupopen:l,popupclose:s}),null==e.overlayContainer?(null!=i&&n.setLatLng(i),n.openOn(e.map)):e.overlayContainer.bindPopup(n),function(){var t;e.map.off({popupopen:l,popupclose:s}),null==(t=e.overlayContainer)||t.unbindPopup(),e.map.removeLayer(n)}}),[t,e,a,o,r,i])})),h=(0,c.Au)((function({positions:t,...e},n){const a=new u.Polyline(t,e);return{instance:a,context:{...n,overlayContainer:a}}}),(function(t,e,n){e.positions!==n.positions&&t.setLatLngs(e.positions)}));var g=n(795),v=n(4968),x=n(6584),b=n(1372),y=(n(6538),n(9941),n(4542),n(4349)),m=n.n(y),j=(n(2818),n(4925)),S=n(2785),w=[[0,0,0,0,0],[300,1,21,5,4.5],[600,3,42,10,9],[900,4,63,15,13.5],[1200,5,84,20,18],[1500,6,105,25,22.5],[1800,8,126,30,27],[2100,9,147,35,31.5],[2400,10,168,40,36],[2700,11,189,45,40.5],[3e3,13,210,50,45],[3300,14,231,55,49.5],[3600,15,252,60,54],[3900,16,273,65,58.5],[4200,18,294,70,63],[4500,19,315,75,67.5],[4800,20,336,80,72],[5100,21,357,85,76.5],[5400,23,378,90,90],[5700,24,399,95,85.5],[6e3,25,420,100,90]];function C(t){for(var e=0;e<w.length;e++)if(w[e][3]>=t)return w[e][1]}var M=n(2334),k=n(5893),O=["serialControl","play","autoDrive","targetBoatSpeed","boatManager","engineControl"],N=function(t){var e=t.serialControl,n=(t.play,t.autoDrive,t.targetBoatSpeed),a=(t.boatManager,t.engineControl,(0,r.Z)(t,O),(0,S.Z)((function(t){return t.boatSpeed}))),o=(0,S.Z)((function(t){return t.boatAngle})),i=(0,S.Z)((function(t){return t.currentPosition})),s=((0,S.Z)((function(t){return t.aPath})),(0,l.useState)({lat:0,lng:0})),c=s[0],u=s[1],p=(0,l.useState)({x:0,y:0}),f=p[0],d=p[1],h=(0,l.useState)(-45),g=h[0],v=h[1],x=(0,l.useState)(1),b=x[0],y=x[1],m=(0,l.useState)(!1),j=m[0],w=m[1],N=(0,l.useState)(null),Z=(N[0],N[1],(0,l.useState)([])),A=(Z[0],Z[1]),P=(0,l.useState)(!0),D=(P[0],P[1],Date.now()),L=(0,l.useState)(0),B=L[0],R=L[1],I=(0,l.useState)(25),E=I[0],_=I[1],T=(0,l.useState)(0),z=T[0],F=T[1],U=(0,l.useState)(0),H=(U[0],U[1],l.useRef()),J=function(t){var e=1.852*t*.6;u({lat:e/110574,lng:e/111320})},W=function(t){var e=0,n=1,a={x:Math.cos(t*Math.PI/180)*e-Math.sin(t*Math.PI/180)*n,y:Math.sin(t*Math.PI/180)*e+Math.cos(t*Math.PI/180)*n};d(a)},q=function(t,e,n){return Math.min(Math.max(t,e),n)};(0,l.useEffect)((function(){G()}),[i]);var G=function(){var t=S.Z.getState().Tiles,e=S.Z.getState().pixelBoatPosition;if(t&&e){var n={x:q(Math.round(f.x),-1,1),y:q(-1*Math.round(f.y),-1,1)},a={x:-1*n.y,y:n.x},o={x:n.y,y:-1*n.x},r=t[e.x+o.x][e.y+o.y].weight,i=t[e.x+a.x][e.y+a.y].weight,l=function(t,e,n){for(var a=t.x>=n?t.x-n:0,o=t.y>=n?t.y-n:0,r=t.x+n>=e.length-1?e.length-1:t.x+n,i=t.y+n>=e[0].length-1?e[0].length-1:t.y+n,l=0,s=(r-a)*(i-o),c=a;c<=r;c++)for(var u=o;u<=i;u++)l+=e[c][u].weight;return l/s}(e,t,3);S.Z.setState({forwardDirection:n,rightDirection:a,leftDirection:o,shipLeftWeight:r,shipRightWeight:i,shipAverageWeight:l})}},K=function(){console.log("Apply navigation called"),$(z,n),j?(A(S.Z.getState().aPath),function(){var t=S.Z.getState().aPath;if(console.log(t),t.length>1){var e=t.length-2;t.length<3&&Q();var n={lat:t[e].lat,lng:t[e].lng};if(!n)return;var a=180*Math.atan2(n.lng-i.lng,n.lat-i.lat)/Math.PI*-1;console.log("Cur pos is  = "+i.lat+" X "+i.lng),W(a)}else Q()}(),o=V(f)):(W(g),o=-g),S.Z.setState({allowMovement:!0,boatAngle:o,departureTime:Date.now()})},Q=function(){console.log("Stop navigation called"),e.sendCode("INIT"),$(z,0)};function Y(t){return t*(Math.PI/180)}function $(t,e){R((n-t)/e)}function X(){var t=Date.now()-D,e=S.Z.getState().currentBoatspeed+t/1e3*B;B>0&&e>=n||B<0&&e<=n?F(n):(H.current=setTimeout((function(){return F((function(e){return e+t/1e3*B})),X(),function(){clearTimeout(H.current)}}),500),D=Date.now())}function V(t){return t=180*Math.atan2(t.x,t.y)/Math.PI}return(0,l.useEffect)((function(){var t=S.Z.getState().aPath;if(j&&t.length>0){var n=t.length-2,a={lat:0,lng:0};if(t.length>=3)a={lat:t[n=t.length-2].lat,lng:t[n].lng};else if(2==t.length)a={lat:t[n=0].lat,lng:t[n].lng};else{if(1!=t.length)return void Q();var r=S.Z.getState().destinationPosition;a={lat:r.lat,lng:r.lng}}J(z);var l={x:0,y:0};for(l.x=a.lng-i.lng,l.y=a.lat-i.lat;Math.abs(l.x)<.09&&Math.abs(l.y)<.09;)l.x=10*l.x,l.y=10*l.y;for(;Math.abs(l.x)<.5&&Math.abs(l.y)<.5;)l.x=2*l.x,l.y=2*l.y;if(o=V(l),console.log(S.Z.getState().boatAngle.toString()),function(t,n){if(S.Z.getState().allowMovement){var a=(0,M.QI)(t),o=(0,M.QI)(n)-a;if(console.log("Angel Diffrence is "+o),Math.abs(o)<=10)return console.log("Go Straight"),void e.sendCode("ZR");if(o>180||o<0){console.log("Turn Left");var r=q(10*Math.round(o/10),10,80)/2;e.sendCode("P"+r)}else{console.log("Turn Right");var i=q(10*Math.round(function(t){t>180?t=180:t<0&&(t=Math.abs(t));return t}(o)/10),10,80)/2;e.sendCode("S"+i)}}}(S.Z.getState().boatAngle,o),d(l),t[t.length-1]=i,function(t,e,n,a){var o=Y(n-t),r=Y(a-e),i=Math.sin(o/2)*Math.sin(o/2)+Math.cos(Y(t))*Math.cos(Y(n))*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371}(i.lat,i.lng,a.lat,a.lng)<=.02){if(1==t.length)return void Q();t.splice(n,1)}A(t),S.Z.setState({boatAngle:o})}}),[i]),(0,l.useEffect)((function(){G(),a.lat=c.lat*f.y*b,a.lng=c.lng*f.x*b,S.Z.setState({boatSpeed:a})}),[c,f]),(0,l.useEffect)((function(){var t;0==(t=z)||t>=C(100)||t>=C(75)||C(50);J(z),S.Z.setState({currentBoatspeed:z})}),[z]),(0,l.useEffect)((function(){null!=H.current&&clearTimeout(H.current),X()}),[B]),(0,k.jsxs)("div",{className:"h-full overflow-auto",children:[(0,k.jsx)("h1",{children:" Autoboat control panel "}),(0,k.jsx)("h1",{children:" Speed (Knot) "}),(0,k.jsx)("input",{type:"number",value:E,onChange:function(t){return _(t.target.value)}}),(0,k.jsx)("h1",{children:" Forward Angle (Counter Clockwise)"}),(0,k.jsx)("input",{type:"number",value:g,onChange:function(t){return v(t.target.value)}}),(0,k.jsx)("h1",{children:" Time multiplier (Default = 1)"}),(0,k.jsx)("input",{type:"number",value:b,onChange:function(t){return y(t.target.value)}}),(0,k.jsx)("br",{}),(0,k.jsx)("input",{type:"checkbox",name:"autoDrive",value:j,onChange:function(t){return w(t.target.value)}}),(0,k.jsx)("label",{children:"Auto Drive"}),(0,k.jsx)("br",{}),(0,k.jsxs)("div",{children:[(0,k.jsx)("input",{type:"radio",name:"clickMode",value:"Boat",onChange:function(t){S.Z.setState({clickControl:"Boat"})}})," Add Marker (Click to add) ",(0,k.jsx)("br",{}),(0,k.jsx)("input",{type:"radio",name:"clickMode",value:"Start",onChange:function(t){S.Z.setState({clickControl:"Start"})}})," Move Start Marker ",(0,k.jsx)("br",{}),(0,k.jsx)("input",{type:"radio",name:"clickMode",value:"End",onChange:function(t){S.Z.setState({clickControl:"End"})}})," Move End Marker ",(0,k.jsx)("br",{})]}),(0,k.jsx)("button",{onClick:function(){return K()},children:" Apply changes "}),(0,k.jsx)("br",{}),(0,k.jsx)("button",{onClick:function(){return Q()},children:" Stop Boat "}),(0,k.jsx)("br",{})]})},Z=n(7516),A=n(5434),P=n(9352),D=["enabled","triggerAlert","onChange","boatManager"],L=function(t){var e,n=t.enabled,o=t.triggerAlert,i=t.onChange,s=t.boatManager,c=((0,r.Z)(t,D),(0,l.useState)(!0)),u=c[0],p=c[1],f=(0,l.useState)(!0),d=f[0],h=f[1],g=(0,l.useState)(""),v=g[0],x=g[1],b=(0,l.useState)(!1),y=b[0],m=b[1],j=(0,l.useState)(!1),S=j[0],w=j[1],C=(0,l.useState)(0),M=C[0],O=C[1],N=(0,l.useState)(!1),L=N[0],B=N[1],R=(0,l.useRef)(),I=(0,l.useRef)(),E=(0,l.useState)({mapClass:"absolute z-0 opacity-100"}),_=E[0],T=E[1];(0,l.useEffect)((function(){T({mapClass:u?"absolute z-0 opacity-100":"absolute z-0 opacity-0",play:y,autoDrive:S,triggerRenderCount:M,speed:R.current.value,animBoatShow:d})}),[u,d,y,S,M]),(0,l.useEffect)((function(){i(_)}),[_]),(0,l.useEffect)((function(){R.current.value=25}),[]);var z=(0,k.jsxs)("div",{className:"flex flex-col",children:[(0,k.jsxs)("div",{className:"tools",children:[(0,k.jsx)("label",{htmlFor:"tools",className:"label text-sm",children:"Tools"}),(0,k.jsxs)("div",{className:"px-4 flex flex-wrap w-full",children:[(0,k.jsx)("div",{"data-tip":y?"Stop":"Play",className:"tooltip",children:(0,k.jsx)("button",{className:"btn btn-xs hover:opacity-100 opacity-50",onClick:function(){m((function(t){return!t}))},children:y?(0,k.jsx)(Z.tAB,{}):(0,k.jsx)(Z.PHf,{})})}),(0,k.jsx)("div",{"data-tip":"Auto Drive",className:"tooltip",children:(0,k.jsx)("button",{className:"btn btn-xs hover:opacity-100 ".concat(S?"opacity-100":"opacity-50"),onClick:function(){w((function(t){return!t}))},children:(0,k.jsx)(P.yCE,{})})}),(0,k.jsx)("div",{"data-tip":"Generate Path",className:"tooltip",children:(0,k.jsx)("button",{className:"btn btn-xs opacity-50 hover:opacity-100",onClick:function(){I.current.checked=!1,B(I.current.checked),O(M+1)},children:(0,k.jsx)(Z.t5J,{})})}),(0,k.jsx)("div",{"data-tip":(u?"Hide":"Show")+" Map",className:"tooltip",children:(0,k.jsx)("button",{className:"btn btn-xs opacity-50 hover:opacity-100",onClick:function(){return p((function(t){return!t}))},children:u?(0,k.jsx)(Z.nJ9,{}):(0,k.jsx)(Z.A7v,{})})}),(0,k.jsx)("div",{"data-tip":"Departure",className:"tooltip",children:(0,k.jsx)("button",{className:"btn btn-xs hover:opacity-100 ".concat("Start"==v?"opacity-100":"opacity-50"),onClick:function(){x("Start"),s.clickControl="Start"},children:(0,k.jsx)(A.JDL,{})})}),(0,k.jsx)("div",{"data-tip":"Destination",className:"tooltip",children:(0,k.jsx)("button",{className:"btn btn-xs hover:opacity-100 ".concat("End"==v?"opacity-100":"opacity-50"),onClick:function(){x("End"),s.clickControl="End"},children:(0,k.jsx)(A.$0r,{})})}),(0,k.jsx)("div",{"data-tip":"Obstacle",className:"tooltip",children:(0,k.jsx)("button",{className:"btn btn-xs hover:opacity-100 ".concat("Boat"==v?"opacity-100":"opacity-50"),onClick:function(){x("Boat"),s.clickControl="Boat"},children:(0,k.jsx)(A.JDL,{className:"text-yellow-400"})})}),(0,k.jsx)("div",{"data-tip":(d?"Hide":"Show")+" Animated Boats",className:"tooltip",children:(0,k.jsx)("button",{className:"btn btn-xs opacity-50 hover:opacity-100",onClick:function(){return h((function(t){return!t}))},children:d?(0,k.jsx)(Z.nJ9,{className:"text-yellow-400"}):(0,k.jsx)(Z.A7v,{className:"text-yellow-400"})})}),(0,k.jsx)("div",{"data-tip":"Clear Selection",className:"tooltip",children:(0,k.jsx)("button",{className:"btn btn-xs hover:opacity-100 ".concat("Boat"==v?"opacity-100":"opacity-50"),onClick:function(){x(""),s.clickControl="",s.clearObstacles()},children:(0,k.jsx)(A.lUB,{})})})]})]}),(0,k.jsxs)("div",{className:"form-control",children:[(0,k.jsx)("label",{htmlFor:"speed",className:"label",children:(0,k.jsx)("span",{className:"text-sm",children:"Speed (kt)"})}),(0,k.jsx)("input",{ref:R,onKeyUp:function(t){t.target.value>25&&(o({description:"Boat reach the maximum speed",icon:(0,k.jsx)(A.YTL,{}),apply:null}),setTimeout((function(){R.current.value=25}),2e3))},id:"speed",type:"number",min:"0",max:"25",className:"input input-bordered input-xs"})]})]});return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("div",{className:"absolute z-50 top-0 w-full h-full ".concat(L?"":"pointer-events-none"),children:[(0,k.jsx)("input",{onChange:function(t){n&&B(t.target.checked)},ref:I,id:"my-drawer",type:"checkbox",className:"drawer-toggle"}),(0,k.jsxs)("div",{className:"drawer-side h-full ".concat(L?"":"pointer-events-none"),children:[(0,k.jsx)("label",{htmlFor:"my-drawer",className:"drawer-overlay"}),(0,k.jsx)("ul",{className:"menu w-1/4 p-4 overflow-y-auto bg-black opacity-90 text-base-content",children:(0,k.jsx)("li",{children:z})})]})]}),(0,k.jsx)("label",(e={className:"absolute z-50",htmlFor:n?"my-drawer":""},(0,a.Z)(e,"className","absolute z-50 bottom-0 btn btn-xs drawer-button"),(0,a.Z)(e,"children",(0,k.jsx)(Z.MBj,{})),e))]})},B=n(8216),R=n(4695),I=n(3444),E=n(268),_=n(2953),T=["id","callback"],z=function(t){var e=t.id,n=t.callback,a=(0,r.Z)(t,T),o=function(t){n({id:e,status:t})};return(0,k.jsxs)("div",{className:"alert",children:[(0,k.jsx)("i",{className:"text-3xl text-red-700",children:a.icon}),(0,k.jsx)("div",{className:"flex-1",children:(0,k.jsx)("label",{className:"mx-3 text-white text-sm",children:a.description})}),(0,k.jsxs)("div",{className:"flex-none",children:[(0,k.jsx)("button",{className:"btn btn-sm btn-ghost mr-2 text-red-700 font-bold",onClick:function(){return o("cancel")},children:"Cancel"}),a.apply&&(0,k.jsx)("button",{className:"btn btn-sm btn-success",onClick:function(){return o("ok")},children:a.apply?a.apply:"Apply"})]})]})};function F(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function U(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?F(Object(n),!0).forEach((function(e){(0,a.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function H(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=(0,_.Z)(t);if(e){var o=(0,_.Z)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return(0,E.Z)(this,n)}}var J=function(t){(0,I.Z)(n,t);var e=H(n);function n(){var t;return(0,B.Z)(this,n),t=e.call(this),(0,a.Z)((0,R.Z)(t),"callback",(function(e){var n=e.id,a=(e.status,t._alert.findIndex((function(t){return t.props.id==n})));console.log("index remove: "+a),t._alert.splice(a,1),t.emit("change",U(U({},e),{},{remain:t._alert}))})),(0,a.Z)((0,R.Z)(t),"generateAlert",(function(e){return(0,k.jsx)(z,U(U({},e),{},{callback:t._callback}),e.id)})),(0,a.Z)((0,R.Z)(t),"create",(function(e){var n=t.generateAlert(e);return t._alert.push(n),console.log(t._alert),n})),(0,a.Z)((0,R.Z)(t),"show",(function(){return t._alert})),(0,a.Z)((0,R.Z)(t),"cleanup",(function(){t._alert.length=0})),t._alert=[],t._callback=t.callback.bind((0,R.Z)(t)),t}return n}(n(7187).EventEmitter),W=["serialControl","boatManager","animatedBoatManager"];function q(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function G(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?q(Object(n),!0).forEach((function(e){(0,a.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var K=new J,Q=function(t){var e=t.serialControl,n=t.boatManager,a=t.animatedBoatManager,i=((0,r.Z)(t,W),n.curPos),c=n.destPos,u={lat:(i.lat+c.lat)/2,lng:(i.lng+c.lng)/2},y=l.useRef(),S=l.useRef(),w=l.useRef(),C=l.useRef(),M=l.useRef(),O=(0,l.useState)(null),Z=O[0],P=O[1],D=(0,l.useState)([]),B=D[0],R=D[1],I=(0,l.useState)([]),E=I[0],_=I[1],T=(0,l.useState)([]),z=T[0],F=T[1],U=(0,l.useState)({boat:null,dest:null}),H=U[0],J=U[1],q=new(p().icon)({iconUrl:"./markerIcons/marker-icon.png",iconSize:new(p().Point)(10,20)}),Q=new(p().icon)({iconUrl:"./markerIcons/otherBoat-icon.png",iconSize:new(p().Point)(10,20)}),Y=function(t){for(var e=0;e<t.length;e++)at(e,t[e]);a.start()},$=function(){n.on("removeObstacle",(function(){if(null!=y.current){for(var t=0;t<n.mapStaticObstacle.length;t++)y.current.removeLayer(n.mapStaticObstacle[t]);n.resetMapObstacle()}}))},X=function(){a.on("moveNPCMarker",(function(t){var e=t.movingBoats;if(null!=e&&10==e.length)for(var n=0;n<e.length;n++){var a=e[n],o=a.curPos,r=a.angle,i=z[n];if(null==i)return void console.log("Ship "+n+" not found in map.");i.slideTo([o.lat,o.lng],{duration:1}),null!=r&&i.setRotationAngle(-r)}}))},V=function(){a.on("showHideAnimatedBoat",(function(t){var e=t.show;null!=e&&(e?y.current.addLayer(M.current):y.current.removeLayer(M.current))}))},tt=function(){e.socket.on("message",(function(t){if(!n.autoDrive){var e=t.split(","),a=e[0].split("$");et(a[1],e[1])}}))},et=function(t,e){e.length>3&&(e=e.substring(0,3)),n.manualSteer(t,e)};function nt(){var t=null;!function(t){const e=s();(0,l.useEffect)((function(){return e.on(t),function(){e.off(t)}}),[e,t])}({click:function(e){console.log("Trigger click at ");var a=n.clickControl.split("-"),o=e.latlng;console.log(o);a.length>1&&parseInt(a[1]);switch(a[0]){case"Boat":var r=new(m())([o.lat,o.lng],{icon:Q,draggable:!1});y.current.addLayer(r),n.addMapObstacle(r),n.setAddShipChange(o),gt(dt+1);break;case"Start":H.boat.setLatLng([o.lat,o.lng]),t={lat:o.lat,lng:o.lng},n.setBoatPosChange(t);break;case"End":H.dest.setLatLng([o.lat,o.lng]),t={lat:o.lat,lng:o.lng},n.setDestPosChange(t)}}});return null===t?null:(0,k.jsx)(f,{position:t,children:(0,k.jsx)(d,{children:"You are here"})})}function at(t,e){var n=e;Array.isArray(e)&&(n=e[0]);var o=new(m())([n.lat,n.lng],{icon:Q,draggable:!1});M.current.addLayer(o);var r=z;r.push(o),F(r),a.addMovingNPCShip(t,n,e)}var ot=function(t){for(var e=[],n=0;n<t.length;n++){var a=[t[n].lat,t[n].lng];e.push(a)}return e},rt=function(t,e){n.on("move",(function(e){var n=e.boatAngle,a=e.curPos;t.setRotationAngle(-n),t.slideTo([a.lat,a.lng],{duration:1})}))},it=(0,l.useState)("absolute z-0 opacity-100"),lt=it[0],st=it[1],ct=(0,l.useState)({play:!1,autoDrive:!1,targetBoatSpeed:0}),ut=ct[0],pt=ct[1],ft=(0,l.useState)(0),dt=ft[0],ht=ft[1],gt=function(t){Z.removeLayer(S.current),Z.removeLayer(w.current),Z.removeLayer(M.current),ht(t)},vt=(0,l.useState)([]),xt=vt[0],bt=vt[1];(0,l.useEffect)((function(){return K.on("change",(function(t){t.id;var e=t.status,a=t.remain;bt((0,o.Z)(a)),"ok"===e&&n.refuel()})),n.on("fuel",(function(t){t.fuel;var e=t.msg,n=K.create({id:xt.length,description:e,icon:(0,k.jsx)(A.Cwk,{}),apply:"refuel"});bt([].concat((0,o.Z)(xt),[n]))})),e.on("data",(function(t){"syncronizeScreen"==t.command&&n.emitSynchronizeData("All")})),function(){K.cleanup(),n.cleanup(),a.cleanup(),n.setupDataListener()}}),[]);var yt=(0,l.useState)(!1),mt=yt[0],jt=yt[1];return(0,k.jsxs)("div",{className:"w-full h-full relative",children:[(0,k.jsx)(j.Z,{className:"absolute z-20",map:Z,onStatus:function(t){2===t.index?jt(!0):jt(!1)},layers:B,triggerRender:dt,onResult:function(t){y.current.addLayer(S.current),y.current.addLayer(w.current),a.show&&y.current.addLayer(M.current);var e=1==t.path.length?[c,i]:t.path,o=ot(e);_(o),n.initialize({boundaries:null!=t.boundaries?t.boundaries:null,imageData:null!=t.imageData?t.imageData:null,aPath:null!=t.path?e:null,tiles:null!=t.tiles?t.tiles:null})},realTimeBy:[i,c],boatManager:n}),(0,k.jsx)("div",{className:"w-full h-full top-0 left-0 ".concat(lt),children:(0,k.jsx)(g.h,{attributionControl:!1,whenCreated:function(t){console.log("Run on map created"),e.sendCode("INIT"),y.current=t,y.current.addLayer(S.current),y.current.addLayer(w.current),y.current.addLayer(C.current),y.current.addLayer(M.current);var o=new(m())([i.lat,i.lng],{icon:q,rotationAngle:0,rotationOrigin:"center"}),r=new(m())([c.lat,c.lng],{draggable:!1});S.current.addLayer(o),S.current.addLayer(r),null!=n.boatAngle&&o.setRotationAngle(-n.boatAngle),J({boat:o,dest:r}),P(t),R([S.current,w.current,M.current]),n.cancelDataListener(),rt(o,r),$(),X(),V(),tt(),Y(a.autoNPCBoatRoute),n.resetMapObstacle()},renderer:p().canvas(),preferCanvas:!0,dragging:!0,center:u,zoom:12,scrollWheelZoom:!1,style:{height:"100%",width:"100%"},children:(0,k.jsxs)(v.et,{position:"topright",children:[(0,k.jsx)(v.et.BaseLayer,{checked:!0,name:"Base Map",children:(0,k.jsx)(x.I,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"})}),(0,k.jsx)(v.et.Overlay,{name:"Marker with popup",children:(0,k.jsx)(b.e,{ref:S})}),(0,k.jsx)(v.et.Overlay,{name:"Moving Boats",children:(0,k.jsx)(b.e,{ref:M})}),(0,k.jsx)(v.et.Overlay,{name:"Route",children:(0,k.jsx)(b.e,{ref:w,children:(0,k.jsx)(h,{pathOptions:{color:"red"},positions:E})})}),(0,k.jsx)(v.et.Overlay,{name:"Static Boats",children:(0,k.jsx)(b.e,{ref:C,children:(0,k.jsx)(nt,{})})})]})})}),(0,k.jsx)(L,{enabled:mt,triggerAlert:function(t){var e=K.create(G({id:xt.length},t));bt([].concat((0,o.Z)(xt),[e]))},onChange:function(t){if(st(t.mapClass),pt({play:t.play,autoDrive:t.autoDrive}),dt!=t.triggerRenderCount&&Z&&gt(t.triggerRenderCount),t.play){var e,o=parseInt(null!==(e=t.speed)&&void 0!==e?e:0);pt({targetBoatSpeed:o}),n.start(parseInt(o),t.autoDrive)}else t.play||n.stop();null!=t.animBoatShow&&t.animBoatShow!=a.show&&a.showHideAnimatedBoat(t.animBoatShow),n.autoDrive!=t.autoDrive&&n.setBoatAutoDrive(t.autoDrive)},boatManager:n}),(0,k.jsx)("div",{className:"absolute z-0 opacity-0 left-full",children:(0,k.jsx)(N,G(G({serialControl:e},ut),{},{boatManager:n}))}),(0,k.jsx)("div",{className:"absolute flex flex-col z-50 top-0 w-full",children:(0,k.jsx)("div",{className:"flex flex-col",children:xt})})]})}},3789:function(t,e,n){"use strict";n.d(e,{Z:function(){return r}});var a=n(6586);var o=n(6988);function r(t){return function(t){if(Array.isArray(t))return(0,a.Z)(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||(0,o.Z)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}}}]);